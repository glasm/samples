var GLZ={parse:function(e){for(var t in e.tex)if("string"==typeof e.tex[t])return void THREE.ImageUtils.loadTexture(e.tex[t],THREE.UVMapping,e.onPass);for(var t in e.obj){for(var n=function(e){return c.faces.charCodeAt(e)-32},o=function(e,t,n){var o=e.charCodeAt(t)-32;return n>1&&(o+=95*(e.charCodeAt(t+1)-32)),n>2&&(o+=9025*(e.charCodeAt(t+2)-32)),o},c=e.obj[t],r=[],a=c.streams,i=c.q,d=1==i?94:3==i?857374:9024,s=0,L=0;L<c.scnt;L+=3){var l=(a[L][1]-a[L][0])/d,m=(a[L+1][1]-a[L+1][0])/d,G=(a[L+2][1]-a[L+2][0])/d;r[s]=new THREE.Geometry,r[s].vertices.length=c.vcnt;for(var W=0;W<c.vcnt;W++)r[s].vertices[W]=new THREE.Vector3(a[L][0]+o(a[L][2],W*i,i)*l,a[L+1][0]+o(a[L+1][2],W*i,i)*m,a[L+2][0]+o(a[L+2][2],W*i,i)*G);s++}if(c.tsmax)for(var E=[],W=0,f=(c.tsmax-c.tsmin)/d,p=(c.ttmax-c.ttmin)/d;W<3*c.fcnt;W++)E[W]=new THREE.Vector2(c.tsmin+o(c.ts,W*i,i)*f,c.ttmin+o(c.tt,W*i,i)*p);for(s=0;s<c.scnt/3;s++)r[s].faces.length=c.fcnt,c.tsmax&&(r[s].faceVertexUvs[0].length=c.fcnt);if(c.fcnt<=95)for(var W=0,L=0;W<c.fcnt;W++,L+=3){var v=new THREE.Face3(n(L),n(L+1),n(L+2));for(s=0;s<c.scnt/3;s++)r[s].faces[W]=v,c.tsmax&&(r[s].faceVertexUvs[0][W]=[E[L].clone(),E[L+1].clone(),E[L+2].clone()])}else if(c.fcnt<=9025)for(var W=0,L=0;W<c.fcnt;W++,L+=6){var v=new THREE.Face3(n(L)+95*n(L+1),n(L+2)+95*n(L+3),n(L+4)+95*n(L+5));for(s=0;s<c.scnt/3;s++)r[s].faces[W]=v,c.tsmax&&(r[s].faceVertexUvs[0][W]=[E[3*W].clone(),E[3*W+1].clone(),E[3*W+2].clone()])}else for(var W=0,L=0;W<c.fcnt;W++,L+=9){var v=new THREE.Face3(n(L)+95*n(L+1)+9025*n(L+2),n(L+3)+95*n(L+4)+9025*n(L+5),n(L+6)+95*n(L+7)+9025*n(L+8));for(s=0;s<c.scnt/3;s++)r[s].faces[W]=v,c.tsmax&&(r[s].faceVertexUvs[0][W]=[E[3*W].clone(),E[3*W+1].clone(),E[3*W+2].clone()])}for(s=0;s<c.scnt/3;s++)r[s].computeFaceNormals(),r[s].computeVertexNormals(),r[s].computeMorphNormals();console.log('submodel "'+e.name+"."+t+'" loaded'),e.obj[t]=r}console.log('model "'+e.name+'" loaded'),e.onComplete()},loadJS:function(e,t){var n=document.getElementsByTagName("head")[0],o=document.createElement("script");o.type="text/javascript",o.src=e,o.onreadystatechange=o.onload=t,n.appendChild(o)},load:function(){GLZ.Race.onPass()},onPrevLoaded:function(){WGL.clear(),WGL.dc.add(new THREE.Prev),GLZ.loadJS("data/"+GLZ.Prev.model)},onModelLoaded:function(){WGL.clear(),WGL.dc.add(new THREE.Model)}},WGL={init:function(){WGL.cont=document.createElement("div"),document.body.appendChild(WGL.cont),WGL.cam=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),WGL.cam.position.set(4,6,8),WGL.scn=new THREE.Scene,WGL.scn.add(new THREE.AmbientLight(13421772)),pointLight=new THREE.PointLight(14540236,.5),pointLight.position.set(500,500,500),WGL.scn.add(pointLight),pointLight=new THREE.PointLight(13421789,.3),pointLight.position.set(-500,300,200),WGL.scn.add(pointLight),WGL.ctx=new THREE.WebGLRenderer({antialias:3==WGL.mob}),WGL.ctx.setSize(window.innerWidth,window.innerHeight),WGL.ctx.setClearColor(13421772,1),WGL.ctx.sortObjects=!1,WGL.cont.appendChild(WGL.ctx.domElement),WGL.dc=new THREE.Object3D,WGL.scn.add(WGL.dc),WGL.dc.position.y=-50,WGL.ctrl=new THREE.OrbitControls(WGL.cam),WGL.ctrl.minDistance=150,WGL.ctrl.maxDistance=500,window.addEventListener("resize",WGL.onResize,!1),WGL.Progress(),WGL.anisotropy=WGL.ctx.getMaxAnisotropy()},onResize:function(){WGL.cam.aspect=window.innerWidth/window.innerHeight,WGL.cam.updateProjectionMatrix(),WGL.ctx.setSize(window.innerWidth,window.innerHeight)},Progress:function(){void 0!=WGL.onEnterFrame&&WGL.onEnterFrame(),requestAnimationFrame(WGL.Progress),WGL.ctrl.update(),WGL.ctx.render(WGL.scn,WGL.cam)},clear:function(){for(var e=WGL.dc.children.length-1;e>=0;e--)WGL.dc.remove(WGL.dc.children[e])}};GLZ.Room={name:"Room",state:"init",tex:{},obj:{},onPass:function(e){for(var t in GLZ.Room.tex)if("string"==typeof GLZ.Room.tex[t])return console.log('texture "'+GLZ.Room.name+"."+t+'" loaded'),e.sourceFile="",e.wrapS=e.wrapT=THREE.RepeatWrapping,GLZ.Room.tex[t]=e,void GLZ.parse(GLZ.Room);GLZ.parse(GLZ.Room)},onComplete:function(){var e=new THREE.Room;WGL.scn.add(e)}},THREE.Room=function(){THREE.Object3D.call(this)},THREE.Room.prototype=Object.create(THREE.Object3D.prototype),GLZ.loadModel=function(e){for(var t=WGL.dc.children.length-1;t>=0;t--)WGL.dc.remove(WGL.dc.children[t]);GLZ.loadJS("data/"+e+"_prev.js")};var cc=document.createElement("canvas");WGL.mob=window.WebGLRenderingContext?1+(cc.getContext("webgl")?2:cc.getContext("experimental-webgl")?1:0):0,WGL.init(),GLZ.parse(GLZ.Room);